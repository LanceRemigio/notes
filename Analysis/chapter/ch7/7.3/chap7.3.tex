\section{Integrating Functions with Discontinuities}

In the last section, we saw how the integrability of \( f  \) is heavily dependent on the continuity of \( f  \). 
\begin{ex}
Consider the function
\[  f(x) = 
\begin{cases}
	1 \ &\text{ for } x \neq 1 \\
	0 \ &\text{ for } x = 1
\end{cases} \] on the interval \( [0,2]  \). Let \( P  \) be any partition of \( [0,2] \). Then we see that \( U(f,P) = 2  \). Notice that the lower sum \( L(f,P ) \) will be less than \( 2  \) for any subinterval containing \( x = 1  \). TO show that \( f  \) is integrable, we can construct a partition that minimizes the effect of the discontinuity by embedding \( x = 1  \) into some very small subinterval.
Let \( \epsilon > 0  \), and consider the partition \( P_{\epsilon } = \{ 0, 1 - \epsilon / 3, 1 + \epsilon / 3, 2  \}. \) Then, 
\begin{align*}
    L(f, P_{\epsilon }) &= \sum_{ k=1 }^{ 3 } m_{k} \Delta x_{k} \\
						&= 1 \Big( 1 - \frac{ \epsilon  }{ 3 }  \Big) + 0(\epsilon ) + 1 \Big( 1 - \frac{ \epsilon  }{ 3 }  \Big) \\
						&= 2 - \frac{ 2 }{ 3 } \epsilon.
\end{align*}
Since \( U(f, P_{\epsilon }) = 2  \), we have 
\[  U(f, P_{\epsilon }) - L(f, P_{\epsilon }) = 2 - 2 +  \frac{ 2  }{ 3  } \epsilon = \frac{  2 }{ 3  } \epsilon < \epsilon. \] By theorem 7.2.8, we conclude that \( f  \) is integrable.
\end{ex}

In the last example, we find that integrating simple functions with a discontinuity is as simple as isolating the discontinuity in some particularly small subinterval of the partition. 

\begin{tcolorbox}
\begin{thm}
	If \( f: [a,b] \to \R  \) is bounded, and \( f  \) is integrable on \( [c,b] \) for all \( c \in (a,b)  \), then \( f  \) is integrable on \( [a,b]  \). An analogous result holds at the other endpoint. 
\end{thm}
\end{tcolorbox}

\begin{proof}
Let \( \epsilon > 0  \). Our goal is to produce a partition \( P  \) such that \( U(f, P ) - L(f, P ) < \epsilon. \) For any partition, we can write 
\begin{align*}
    U(f, P ) - L(f,P ) &= \sum_{ k=1 }^{ n } (M_{k } - m_{k } ) \Delta x_{ k } \\
					   &- (M_{1} - m_{1})(x_{1} - a) + \sum_{ k=2 }^{ n } (M_{k} - m_{ k }) \Delta x_{k }.
\end{align*}
Our goal now is to choose \( x_{1} \) that is close enough to \( a \) such that 
\[  (M_{1} - m_{1})(x_{1} - a ) < \frac{ \epsilon  }{ 2 }. \] Since \( f  \) is bounded, we know there exists \( M > 0  \) satisfying \( | f(x)  | \leq M  \) for all \( x \in [a,b]  \). Noting that \( M_{1} - m_{1} \leq 2M \), we can pick \( x_{1} \) such that 
\[  x_{1} - a < \frac{ \epsilon  }{ 4 M  }. \] By hypothesis, \( f  \) is integrable on \( [x_{1}, b ] \), so there exists a partition \( P_{1}  \) of \( [x_{1}, b] \) for which 
\[  U(f, P_{1}) - L(f, P_{1}) < \frac{ \epsilon  }{ 2 }. \] Finally, let \( P = \{ a \} \cup P_{1} \) be a partition of \(  [a,b]  \) from which it follows that 
\begin{align*}
    U(f,P) - L(f,P) &= (M_{1} - m_{1})(x_{1} - a ) + \sum_{ k=1 }^{ n } (M_{k } - m_{k }) \Delta x_{k } \\
					&\leq 2M ( x_{1} - a ) + (U(f, P_{1}) - L(f,P_{1})) \\
					&< \frac{ \epsilon  }{ 2 }  + \frac{ \epsilon  }{ 2  } \\
					&= \epsilon.
\end{align*}
The same argument can be applied to the other endpoint.
\end{proof}

This theorem allows us to integrate bounded functions on some closed interval with a single discontinuity at its endpoint. Later on, we will prove that a function with \textit{finite} number of discotinuities is still integrable. What about infinite? 

\begin{ex}
Consider Dirichlet's function 
\[  g(x) = 
\begin{cases}
	1 \ &\text{ for } x \in \Q \\
	0 \ &\text{ for } x \in \mathbb{I}.
\end{cases}  \]
Let \( P  \) be some partition of \( [0,1]  \). The density of the rationals in \( \R  \) implies that we can always find an \( x   \) in any subinterval such that \( g(x) = 1  \) which means that \( U(f,P) = 1  \). On the other hand, the irrationals are also dense in \( \R  \) and hence, we can always find an \( x  \) in every subinterval such that \( g(x) = 0  \). Since this holds for every partition \( P  \), we cannot possibly have \( U(f) = L(f)   \). Hence, \( g  \) cannot be an integrable function.
\end{ex}

Another function that is similar to \( g  \) but is actually integrable is Thomae's function (introduced in 4.1).  

\subsection{Exercises} 

\subsubsection{Exercise 7.3.1} Consider the function 
\[  h(x) = 
\begin{cases}
	1 \ &\text{ for } 0 \leq x < 1 \\
	2 \ &\text{ for } x = 1 
\end{cases} \]
over the interval \( [0,1]  \).
\begin{enumerate}
	\item[(a)] Show that \( L(f,P) = 1  \) for every partition \( P  \) of \( [0,1] \).
		\begin{proof}[Solution]
		By definition of \( h(x)  \), we know that for any \( 0 \leq x < 1  \), we have \( h(x) = 1  \). If \( x = 1  \), then a quick calculation will produce \( U(f, P) = 2  \). Since \( L(f,P) \leq U(f,P)  \), we get that \( L(f,P) = 1  \) for every \( 0 \leq x < 1  \).
		\end{proof}
	\item[(b)] Construct a partition \( P  \) for which \( U(f,P) < 1 + 1/ 10 \).
		\begin{proof}[Solution]
			Let \( P = \{ 0,  1 - \frac{ 1 }{ 11 }, 1 + \frac{ 1 }{ 11 },  1 \}  \)
			and let our subintervals be \( [0, 1 - \frac{ 1 }{ 11 } ], [1 - \frac{ 1 }{ 11 }, 1 + \frac{ 1 }{ 11 } ], \) and  \( [1 + \frac{ 1 }{ 10 }, 1] \). Using the definition of \( U(f,P)  \), we write 
			\begin{align*}
				U(f,P) &= \sum_{ k=1 }^{ 3 } M_{k } \Delta x_{k }   \\
					   &= \Big( 1 - \frac{ 1 }{ 11 }  \Big) + 2 \Big( \frac{ 2 }{ 11 }  \Big) - 2 \Big( \frac{ 1 }{ 11 }  \Big) \\
					   &= 1 + \frac{ 1 }{ 11 } \\
					   &< 1 + \frac{ 1 }{ 10 }. 
			\end{align*}
			Hence, we have 
			\[  U(f,P) < 1 + \frac{ 1 }{ 10 }. \]
		\end{proof}
	\item[(c)] Given \( \epsilon > 0  \), construct partition \( P_{\epsilon } \) for which \( U(f,P_{\epsilon }) < 1 + \epsilon \).
		\begin{proof}[Solution]
		Let \( \epsilon > 0  \) and let \( P = \{ 0, 1 - \frac{ \epsilon  }{ 2 } , 1 + \frac{ \epsilon  }{ 2 }, 1  \}  \). Then using the definition of \( U(f,P)  \), we have
		\begin{align*}
		    U(f,P) &= \sum_{ k=1 }^{ 3 } M_{k } \Delta x_{ k }  \\
				   &= \Big( 1 - \frac{ \epsilon  }{ 2 }  \Big) + 2 \epsilon - 2 \cdot \frac{ \epsilon  }{ 2 } \\
				   &= 1 + \frac{ \epsilon  }{ 2 } \\
				   &< 1 + \epsilon. 
		\end{align*}
		Hence, we have 
		\[ U(f,P) < 1 + \epsilon. \]

		\end{proof}
\end{enumerate}


\subsubsection{Exercise 7.3.3} Let 
\[  f(x) = 
\begin{cases}
	1 \ &\text{ if } x = 1 / n \ \text{ for some } n \in \N \\
	0 \ &\text{ otherwise }.
\end{cases}  \]
Show that \( f  \) is integrable on \( [0,1]  \) and compute \( \int_{ 0 }^{ 1 }  f . \)
\begin{proof}
	Let \( \epsilon > 0  \). To show that \( f  \) is integrable, it suffices to show \( U(f, P_{\epsilon }) - L(f, P_{\epsilon }) < \epsilon  \) for some partition \( P_{\epsilon } \) of \( [0,1] \). Note that \( L(f, P ) = 0  \) for all \( x \in [0,1] \). Let us construct \( P_{\epsilon } \) by taking 
	\[  P_{\epsilon } = \Big\{ 0 , \frac{ 1 }{ n } - \epsilon , \frac{ 1 }{ n }  + \epsilon , 1  \Big\}. \]
	Then taking the definition of \( U(f,P_{\epsilon })  \), we have that 
	\begin{align*}
	    U(f,P_{\epsilon }) &= \sum_{ k=1 }^{ 3 } M_{k } \Delta x_{k }   \\
						   &= 0 \Big( \frac{ 1 }{ n }  - \epsilon \Big) + 2 \epsilon  + 0 \Big( 1 - \frac{ 1 }{ n } - \epsilon  \Big) \\
						   &= 2 \epsilon. \\
	\end{align*}
	Since \( L(f, P_{\epsilon }) = 0  \), we have that 
	\[  U(f, P_{\epsilon }) - L(f, P_{\epsilon }) = 2 \epsilon - 0  < \epsilon.  \]
	Hence, \( f  \) is integrable on \( [0,1] \). Note that \( U(f) = 0  \) and hence, we must have 
	\[  \int_{ 0 }^{ 1 } f = 0. \]
\end{proof}

\subsubsection{Exercise 7.3.4} Let \( f  \) and \( g  \) be functions defined on (possibly different) closed intervals, and assume the range of \( f  \) is contained in the domain of \( g  \) so that the composition \( g \circ f   \) is properly defined.
\begin{enumerate}
    \item[(a)] Show, by example, that it is not the case that if \( f  \) and \( g  \) are integrable, then \( g \circ f  \) is integrable.
		\begin{proof}[Solution]
		Let 
		\[ g(x) = 
		\begin{cases}
			1 \ &\text{ for } x \neq 0 \\
			0 \ &\text{ for } x = 0 
		\end{cases}  \] and 
		\[  f(x) = 
		\begin{cases}
			1 / q \ &\text{ for } x \in \Q \\
			0  \ &\text{ for } x \notin \Q 
		\end{cases}.\] The function \( g(x)  \) is continuous everywhere except at \( 0  \) and \( f  \) is continuous at every \( x \in \mathbb{I} \). But the composition of these functions,
		\begin{align*}
			(g \circ f) (x) &= 
			\begin{cases}
				1 \ &\text{ for } x \in \Q \\
				0 \ &\text{ for } x \notin \Q 
			\end{cases}  \\
		\end{align*}
		which is nowhere continuous and hence not integrable on any interval.
		\end{proof}

		Now decide on the validity of each of the following conjectures, supplying a proof or counterexample as appropriate.
	\item[(b)] If \( f  \) is increasing and \( g  \) is integrable, then \( g \circ f  \) is integrable.
		\begin{proof}[Solution]
		Let \( f(x) = x^{2}  \) and define 
		\[  g(x) = 
		\begin{cases}
			\frac{ 1 }{ \sqrt{ x }  } \ &\text{ for } x \neq 0 \\ 
			0 \ &\text{ for } x = 0.
		\end{cases} \]
		Note that \( f  \) is an increasing function while \( g  \) is an integrable function. But note that 
		\[  (g \circ f)(x) = 
		\begin{cases}
			\frac{ 1 }{ | x |  } \ &\text{ for } x \neq 0 \\
			0 \ &\text{ for } x = 0
		\end{cases} \]
		is non-integrable.
		\end{proof}
		
	\item[(c)] If \( f  \) is integrable and \( g  \) is increasing, then \( g \circ f  \) is integrable.
		\begin{proof}
			Let \( \epsilon > 0 \) and \( P_{\epsilon } \) be an arbitrary partition of an arbitrary closed interval \( [a,b] \). Let us first define \( U(g \circ f , P_{\epsilon }) \) and \( L(g \circ f, P_{\epsilon }) \). So we have 
		\begin{align*}
		    U(g \circ f, P_{\epsilon }) &= \sum_{ k=1 }^{ n } g(M_{k}) \Delta y_{ k }   \\
							L(g \circ f, P_{\epsilon })			&= \sum_{ k=1 }^{ n } g(m_{k }) \Delta y_{k }
		\end{align*}
 Let \( \epsilon > 0  \).  Our goal is to show, using our partition \( P_{\epsilon } \), 
		\[ U(g \circ f, P_{\epsilon }) - L(g \circ f, P_{\epsilon }) < \epsilon.  \] Since \( g  \) is an increasing function on \( [a,b] \) and the range of \( f  \) is contained in the domain of \( g  \), we have that \( g  \) is a bounded function. But this means that we can create sequence \( (\sigma_{k } ) \) where \( \sigma_{k } = g(t_{k }) \). Since \( (\sigma_{k }) \) is increasing and bounded, we know it must be convergent and hence it must be Cauchy. So choose \( N \in \N  \) such that for any \( k,k-1 \geq N  \), we 
		\begin{align*}
		    | M'_{k} - m'_{k}   | &= | g(t_{k}) - g(t_{k-1}) | \\ 
								  &= | \sigma_{k} - \sigma_{k-1} | \\ 
									   &< \epsilon
		\end{align*}
		where \( t_{k} \) and \( t_{k-1}  \) are contained in the domain of \( g \).
	Observe that by our properties of the upper and lower sum of \( f  \), we have 
	\[ y_{k} - y_{k-1} \leq M_{k} - m_{k } \ \text{ for all } k.  \]
	Since \( f  \) is integrable, we can choose \( \epsilon = b -a  \) so that
	\begin{align*}
	    U(f, P_{\epsilon }) - L(f, P_{\epsilon }) &< b - a . \\
	\end{align*}
	Putting everything together, we have 
	\begin{align*}
	    U(g \circ f, P_{\epsilon }) - L(g \circ f, P_{\epsilon }) &= \sum_{ k=1 }^{ n } (M'_{k} - m'_{k}) \Delta y_{k} \\
								&= \sum_{ k=1 }^{ n } (M'_{k} - m'_{k }) \Delta y_{k} \cdot  \frac{ \Delta x_{k }  }{  \Delta x_{k } } \\ 
								&=  \frac{ 1 }{ b-a } \sum_{ k=1 }^{ n }  (M'_{k} - m'_{k }) \Delta y_{k} \Delta x_{k } \\
								&\leq \frac{ 1 }{ b-a } \sum_{ k=1 }^{ n } (M'_{k } - m'_{k } )  (M_{k } - m_{k } ) \Delta x_{k } \\
								&< \frac{ \epsilon  }{ b -a  } \sum_{ k=1 }^{ n } (M_{k } - m_{k }) \Delta x_{k } \\
								&< \frac{ \epsilon  }{ b -a  } \cdot b -a  \\
								&= \epsilon.
 	\end{align*}
	Hence, the composition \( g \circ f \) is an integrable function on \( [a,b] \) by Theorem 7.2.8.
	\end{proof}
\end{enumerate}



